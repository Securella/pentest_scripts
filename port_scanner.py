# Modified base from tryhackme.com with the help of:
# source: https://tryhackme.com/room/pythonforcybersecurity

import sys
import socket
import pyfiglet


def probe_port(ip, port, result=1):
    # Parameters:
    # - ip (str): IP address to probe.
    # - port (int): port number to probe.
    # - result (int): Default value for the probe result (default is 1).
    # Returns:
    # - int: 0 if the port is open, 1 otherwise.
    
    try:
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
            sock.settimeout(0.5)
            if sock.connect_ex((ip, port)) == 0:
                result = 0  # Port is open
    except Exception:
        pass
    return result


def scan_ports(ip):
    # scan most common ports
    # Returns:
    # - dict: A dictionary containing open ports and their associated services.
    
    open_ports = {}
    ports = {
        21: "FTP",
        22: "SSH",
        23: "Telnet",
        25: "SMTP",
        53: "DNS",
        80: "HTTP",
        110: "POP3",
        135: "RPC",
        139: "NetBIOS",
        143: "IMAP",
        443: "HTTPS",
        445: "SMB",
        3306: "MySQL",
        3389: "RDP",
        5900: "VNC"
    }
    for port, service in ports.items():
        sys.stdout.flush()
        response = probe_port(ip, port)
        if response == 0:
            open_ports[port] = service
    return open_ports


def print_open_ports(open_ports):
    if open_ports:
        print("Open Ports are:")
        for port, service in sorted(open_ports.items()):
            print(f"Port {port}: {service}")
    else:
        print("Looks like no ports are open, sorrito :(")


def main():
    ascii_banner = pyfiglet.figlet_format("Oona's \n Pentest \nPort Scanner")
    print(ascii_banner)

    # Ask user for input
    ip = input("Enter the IP address or URL to scan: ")

    open_ports = scan_ports(ip)
    print_open_ports(open_ports)


if __name__ == "__main__":
    main()

