# source for the base code: https://medium.com/@cn.cyber/advanced-python-scripting-for-penetration-testers-boosting-your-arsenal-509879d95fcb
import requests
from bs4 import BeautifulSoup
import re
import sys
import csv


def scrape_emails(url):
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')
    emails = re.findall(r'\S+@\S+', soup.get_text())
    return set(emails)


def save_to_csv(emails, filename):
    with open(filename, 'w', newline='') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(["Email"])
        for email in emails:
            writer.writerow([email])


if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("Usage: python3 email_scraper.py <URL> <output.csv> OR python email_scraper.py <URL> <output.txt>")
        sys.exit(1)

    url = sys.argv[1]
    output_file = sys.argv[2]

    email_set = scrape_emails(url)
    if email_set:
        for email in email_set:
            print("[+] Found Email: " + email)
        save_to_csv(email_set, output_file)
        print(f"Results saved to {output_file}")
    else:
        print("No emails found on the page.")
